
SRCDIR          = @srcdir@
TESTBED_SRCDIR  = @top_srcdir@
OBJDIR          = ../..
SUBDIR          = sensors/slothd

SBIN_SCRIPTS    = sdisrunning sddeploy

include $(OBJDIR)/Makeconf

CC?=gcc
CFLAGS+= -Wall -I${OBJDIR} -I/usr/local/include -I$(TESTBED_SRCDIR)/lib/libtb
LDFLAGS+= -L${OBJDIR}/lib/libtb -L/usr/local/lib/mysql
SDLIBS+= -ltb -lmysqlclient
LIBS=
CP= cp -pf

PROGS= slothd sdcollectd

all: $(PROGS)

include ${TESTBED_SRCDIR}/GNUmakerules

linux: islinux slothd
	$(CP) slothd linux/slothd

fbsd: isfbsd slothd
	$(CP) slothd fbsd/slothd

slothd: slothd.o slothd.h version.o
	$(CC) $(CFLAGS) $(LDFLAGS) -static -o $@ slothd.o version.o $(LIBS)

sdcollectd: sdcollectd.o sdcollectd.h version.o
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ sdcollectd.o version.o $(SDLIBS)

version.c: slothd.c slothd.h sdcollectd.c sdcollectd.h
	echo >$@ "char build_info[] = \"Built `date +%d-%b-%Y` by `id -nu`@`hostname | sed 's/\..*//'`:`pwd`\";"

islinux:
	@uname -s | grep inux > /dev/null

isfbsd:
	@uname -s | grep BSD > /dev/null

install: $(addprefix $(INSTALL_SBINDIR)/, $(SBIN_SCRIPTS))

clean:
	rm -f *.o $(PROGS) *~ core *.core version.c

