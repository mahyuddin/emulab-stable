#! /usr/bin/env python
#
# EMULAB-COPYRIGHT
# Copyright (c) 2004 University of Utah and the Flux Group.
# All rights reserved.
#
import sys
import getopt
sys.path.append("@prefix@/lib")
import socket
import sshxmlrpc
from emulabserver import *

DEFAULT_MODULE = "experiment"
module         = DEFAULT_MODULE

#
# Optional argument indicates what module the server wants to use. This
# will probably change a lot in the future!
#
if len(sys.argv) > 1:
    module = sys.argv[1]
    pass

#
# This is invoked inside an SSH, typically from the paperbag shell.
# We use stdin/stdout to read/write the request/response. We handle
# just a single request this way, and then exit. 
# 
# Construct and wrap our object.
server  = eval(module + "()")
wrapper = sshxmlrpc.SSHServerWrapper(server)
# Handle the request on stdin and send the response to stdout.
wrapper.serve_forever((sys.stdin, sys.stdout))
sys.exit(0)
