#!/usr/bin/perl -w
#
# EMULAB-COPYRIGHT
# Copyright (c) 2008 University of Utah and the Flux Group.
# All rights reserved.
#
use strict;

use lib '@prefix@/lib';
use User;
use Experiment;
use GeniSAClient;
use GeniCMClient;
use English;

#GeniSAClient::RegisterUser(User->ThisUser());

my $experiment = Experiment->Lookup("testbed", "one-node");
my $slice;
my $resources;
my $ticket;
my $sliver;
my $rspec = { "node_id"   => "pc159",
	      "granted"   => 0};

GeniCMClient::DiscoverResources($experiment, \$resources);
print $resources->[0] . "\n";

GeniCMClient::GetTicket($experiment, $resources->[0], $rspec, \$ticket);
open(T, "> /tmp/T");
print T $ticket->asString();
close(T);
exit(0);
     
if (defined($ticket)) {
    GeniCMClient::CreateSliver($experiment, $ticket, \$sliver);
}

# Wait for input before proceeding.
$_ = <STDIN>;

if (defined($sliver)) {
    print $sliver . "\n";
    GeniCMClient::DestroySliver($experiment, $sliver);
}


