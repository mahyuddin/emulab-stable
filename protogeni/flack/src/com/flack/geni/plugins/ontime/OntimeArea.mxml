<?xml version="1.0" encoding="utf-8"?>
<plugins:PluginArea xmlns:fx="http://ns.adobe.com/mxml/2009" 
					xmlns:s="library://ns.adobe.com/flex/spark" 
					xmlns:mx="library://ns.adobe.com/flex/mx"
					xmlns:plugins="com.flack.geni.plugins.*"
					Title="OnTime"
					initialize="init()"
					remove="destroy()">
	<fx:Declarations>
		<s:RadioButtonGroup id="mcTypeGroup" />
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import com.flack.geni.resources.virtual.Sliver;
			import com.flack.shared.FlackEvent;
			import com.flack.shared.SharedMain;
			import com.flack.shared.utils.ImageUtil;
			import com.flack.shared.utils.NetUtil;
			
			public function init():void
			{
				SharedMain.sharedDispatcher.addEventListener(FlackEvent.CHANGED_SLICE, tryUpdate);
				update();
			}
			
			public function destroy():void
			{
				SharedMain.sharedDispatcher.removeEventListener(FlackEvent.CHANGED_SLICE, tryUpdate);
			}
			
			public function tryUpdate(e:FlackEvent):void
			{
				if(e.changedObject == slice)
				{
					update();
				}
			}
			
			public function update():void
			{
				// Allow instrumentize if slice is ready
				var status:String = slice.Status;
				switch(status)
				{
					case Sliver.STATUS_READY:
						instrumentizeButton.enabled = true;
						break;
					default:
						instrumentizeButton.enabled = false;
				}
				
				// Allow portal if ready
				var details:SliceOntimeDetails = Ontime.instruemtizeDetails[slice.id.full];
				gotoPortalButton.enabled = details != null && details.hasAnyPortal();
			}
			
			// enable instrumentize after slice is created
			//  - check OS?
			//  - check manager?
			
			// successfully instrumentized w/portal, show button
			
			public function tryInstrumentize():void
			{
				Ontime.instrumentizeSlice(slice, true, versionDropdownlist.selectedItem, useVirtualMcsRadiobutton.selected);
				host.dashboardViewstack.selectedChild = host.sliceView;
			}
		]]>
	</fx:Script>
	
	<s:Button id="tutorialButton"
			  width="100%"
			  height="32"
			  label="Read Tutorial"
			  toolTip="Read the tutorial about how to use INSTOOLS"
			  icon="{ImageUtil.helpIcon}"
			  click="NetUtil.openWebsite('http://www.netlab.uky.edu/p/instools/')" />
	
	<s:Rect />
	
	<s:Button id="instrumentizeButton"
			  width="100%"
			  height="32"
			  label="Instrumentize"
			  enabled="false"
			  toolTip="Instrumentize experiment with INSTOOLS"
			  icon="{ImageUtil.lightningIcon}"
			  click="tryInstrumentize()" />
	
	<s:VGroup width="100%">
		<s:HGroup width="100%" verticalAlign="middle">
			<s:Label text="APIv" />
			<s:DropDownList id="versionDropdownlist" width="100%" requireSelection="true">
				<s:ArrayCollection>
					<fx:Number>1</fx:Number>
					<fx:Number>2</fx:Number>
				</s:ArrayCollection>
			</s:DropDownList>
		</s:HGroup>
		<s:HGroup width="100%" verticalAlign="middle">
			<s:RadioButton id="useRawMcsRadiobutton" label="Raw MCs" selected="true" />
			<s:RadioButton id="useVirtualMcsRadiobutton" label="Virtual MCs" />
		</s:HGroup>
		
	</s:VGroup>
	
	<s:Rect />
	
	<s:Button id="gotoPortalButton"
			  width="100%"
			  height="32"
			  label="Go to portal"
			  enabled="false"
			  toolTip="Go to portal to see instrumentized data"
			  icon="{ImageUtil.barchartIcon}"
			  click="Ontime.goToPortal(slice)" />
	
</plugins:PluginArea>
