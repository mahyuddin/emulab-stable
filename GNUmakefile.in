#
# Testbed Makefile
#
SRCDIR = 	 @srcdir@
TESTBED_SRCDIR = @top_srcdir@

include Makeconf

SUBDIRS = lib assign discvr tbsetup db os security pxe tmcd www tip capture

all:		all-subdirs
install:	install-subdirs
	echo "DON'T FORGET TO RUN A POST-INSTALL AS ROOT"
post-install:
	@$(MAKE) -C tbsetup post-install
	@$(MAKE) -C security post-install
clean:		clean-subdirs
distclean:	distclean-subdirs
	rm -f Makeconf GNUmakefile config.status config.cache config.log

# How to recursively descend into subdirectories to make general
# targets such as `all'.
%.MAKE:
	@$(MAKE) -C $(dir $@) $(basename $(notdir $@))
%-subdirs: $(addsuffix /%.MAKE,$(SUBDIRS)) ;

# By default, make any target by descending into subdirectories.
%: %-subdirs ;

.PHONY: post-install

# Get rid of a bunch of nasty built-in implicit rules.
.SUFFIXES:
