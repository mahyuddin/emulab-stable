#
# Testbed Makefile
#
SRCDIR		= @srcdir@
OBJDIR		= .
SUBDIR		= 
TESTBED_SRCDIR  = @top_srcdir@
DISTCLEAN_FILES = @DISTCLEAN_FILES@ 

include Makeconf

SUBDIRS = lib assign discvr tbsetup db os security pxe tmcd www tip capture

all:		all-subdirs

install:	install-subdirs install-mkdirs
	@echo "DON'T FORGET TO RUN A POST-INSTALL AS ROOT"

post-install:
	@$(MAKE) -C tbsetup post-install
	@$(MAKE) -C security post-install

install-mkdirs:
	-mkdir -p $(INSTALL_TOPDIR)/locks
	-mkdir -p $(INSTALL_TOPDIR)/log
	-mkdir -p $(INSTALL_TOPDIR)/lists

clean:		clean-subdirs
distclean:	distclean-subdirs
	rm -f Makeconf GNUmakefile config.status config.cache config.log
	rm -f $(DISTCLEAN_FILES)

# How to recursively descend into subdirectories to make general
# targets such as `all'.
%.MAKE:
	@$(MAKE) -C $(dir $@) $(basename $(notdir $@))
%-subdirs: $(addsuffix /%.MAKE,$(SUBDIRS)) ;

# By default, make any target by descending into subdirectories.
%: %-subdirs ;

.PHONY: post-install install-mkdirs

# Get rid of a bunch of nasty built-in implicit rules.
.SUFFIXES:
