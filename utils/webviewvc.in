#!/usr/local/bin/python
# -*-python-*-
#
# Copyright (C) 1999-2002 The ViewCVS Group. All Rights Reserved.
#
# By using this file, you agree to the terms and conditions set forth in
# the LICENSE.html file which can be found at the top level of the ViewCVS
# distribution or at http://viewcvs.sourceforge.net/license-1.html.
#
# Contact information:
#   Greg Stein, PO Box 760, Palo Alto, CA, 94302
#   gstein@lyra.org, http://viewcvs.sourceforge.net/
#

LIBRARY_DIR = r"/usr/testbed/viewcvs-1.0/lib"
CONF_PATHNAME = r"/usr/testbed/viewcvs-1.0/viewcvs.conf"

#########################################################################
#
# Adjust sys.path to include our library directory
#
import sys
import os
import re

sys.path.insert(0, LIBRARY_DIR)

#
# We must get a -repo argument.
#
if len(sys.argv) != 3:
    sys.exit(1)
    pass

if sys.argv[1] != "-repo":
    sys.exit(1)
    pass
repodir = sys.argv[2]

# go do the work
import sapi
import viewcvs

viewcvs._legal_params['exptidx'] = viewcvs._re_validate_number
viewcvs._sticky_vars.append('exptidx')
viewcvs._legal_params['eid'] = re.compile('^[-_a-zA-Z0-9]+$')
viewcvs._sticky_vars.append('eid')
viewcvs._legal_params['pid'] = viewcvs._re_validate_number
viewcvs._sticky_vars.append('pid')

server = sapi.CgiServer()
cfg = viewcvs.load_config(CONF_PATHNAME, server)

cfg.general.default_root = 'svn'
cfg.general.svn_roots    = {'svn' : repodir}
cfg.options.docroot      = "/cvsweb/viewvc"

viewcvs.main(server, cfg)
