SRCDIR		= @srcdir@
TESTBED_SRCDIR	= @top_srcdir@
OBJDIR		= ..
SUBDIR		= capture

include $(OBJDIR)/Makeconf

all: capture capserver capture-tty

include $(TESTBED_SRCDIR)/GNUmakerules

DBFLAGS	+= -DTBDBNAME='"$(TBDBNAME)"' -I/usr/local/include

DESTDIR=

#
# Define LOG_DROPS to record warnings in syslog whenever chars were dropped
# due to the output device/pty being full.
#
CFLAGS= -g -O2 -DLOG_DROPS

capture: capture.c capdecls.h
	cc $(CFLAGS) -DUSESOCKETS -o capture $<

capture-tty: capture.c capdecls.h
	cc $(CFLAGS) -o capture-tty $<

capserver:	capserver.c capdecls.h
	cc $(CFLAGS) $(DBFLAGS) -o capserver $< \
		-L/usr/local/lib/mysql -lmysqlclient

#
# Do not capture install by default.
#
install:	all $(INSTALL_SBINDIR)/capserver

real-install:	all $(INSTALL_SBINDIR)/capserver
	install -s capture $(DESTDIR)/usr/site/bin

tipserv-install:	all
	install -s capture $(DESTDIR)/usr/site/bin

clean:
	rm -f *.o capture core errs Errs
