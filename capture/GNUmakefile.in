#
# EMULAB-COPYRIGHT
# Copyright (c) 2000-2002 University of Utah and the Flux Group.
# All rights reserved.
#

SRCDIR		= @srcdir@
TESTBED_SRCDIR	= @top_srcdir@
OBJDIR		= ..
SUBDIR		= capture

include $(OBJDIR)/Makeconf

all:		boss-all tipserv-all
boss-all:	capserver
tipserv-all:	capture capture-tty

include $(TESTBED_SRCDIR)/GNUmakerules

DBFLAGS	+= -I/usr/local/include

DESTDIR=

#
# Define LOG_DROPS to record warnings in syslog whenever chars were dropped
# due to the output device/pty being full.
#
CFLAGS= -g -O2 -DLOG_DROPS -I${OBJDIR}

capture: capture.c capdecls.h
	cc $(CFLAGS) -DUSESOCKETS -DWITHSSL -DPREFIX=\"$(TBROOT)\" -o capture $< -lssl -lcrypto

capture-nossl: capture.c capdecls.h
	cc $(CFLAGS) -DUSESOCKETS -DPREFIX=\"$(TBROOT)\" -o capture-nossl $< 

capture-tty: capture.c capdecls.h
	cc $(CFLAGS) -o capture-tty $<

capserver:	capserver.c capdecls.h
	cc $(CFLAGS) $(DBFLAGS) -o capserver $< \
		-L/usr/local/lib/mysql -lmysqlclient

#
# Do not capture install by default.
#
install:	all $(INSTALL_SBINDIR)/capserver

real-install:	all $(INSTALL_SBINDIR)/capserver $(INSTALL_SBINDIR)/capture

tipserv-install:	tipserv-all $(INSTALL_SBINDIR)/capture

clean:
	rm -f *.o capture core errs Errs
