#!/usr/local/bin/perl -w

use DBI;
$driver = "mysql";
$dbh = DBI->connect("DBI:$driver:database=tbdb;host=localhost")
    || die "Could not connect.\n";
#A program to delete or add users to the tesbed database.
#"usrud -d UID" deletes that user from users, grp_memb and proj_memb.
#"usrud -a UID ..." adds a user to users along with information supplied on the command line
if ($#ARGV >= 1) {
    ($oper, @usrs) = @ARGV;
    if ($oper eq '-d') {
	foreach $n (@usrs) {
	    chomp($n);
	    $sth = $dbh->prepare("DELETE FROM users WHERE uid = \"$n\"");
	    $sth2 = $dbh->prepare("DELETE FROM grp_memb WHERE uid = \"$n\"");
	    $sth3 = $dbh->prepare("DELETE FROM proj_memb WHERE uid = \"$n\"");
	    $rr = $sth->execute;
	    $rr == 0 && die "User $n not found.\n";
	    $sth2->execute;
	    $sth3->execute;
	    print "User $n removed.\n"; 
	}
    } elsif ($oper eq '-a') { 
	chomp(@usrs);
	$#usrs = 6;
	$sth = $dbh->prepare("INSERT INTO users VALUES ('$usrs[0]', now(), '$usrs[1]', '$usrs[2]', '$usrs[3]', '$usrs[4]', '$usrs[5]', '$usrs[6]')");
	$ra = $sth->execute;
	$ra == 0 || print "User added.\n";
    } else {
	print "Incorrect command: \"-d\" or \"-a\" expected.\n";
    }
} else {
    print "Type the command \"-r\" and a username to remove an user from the database or \"-a\" and a user ID to add a new user to the database.\n";
}


