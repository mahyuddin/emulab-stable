#
# Insert Copyright Here.
#
SRCDIR		= @srcdir@
TESTBED_SRCDIR	= @top_srcdir@
OBJDIR		= ..
SUBDIR		= security

include $(OBJDIR)/Makeconf

BINS		= suexec
SCRIPTS		= paperbag plasticwrap

#
# Force dependencies on the scripts so that they will be rerun through
# configure if the .in file is changed.
# 
all:	$(BINS) $(SCRIPTS)

include $(TESTBED_SRCDIR)/GNUmakerules

CFLAGS	= -O -g \
	  -DLOG_EXEC='"$(prefix)/log/suexec.log"' \
	  -DDOC_ROOT='"$(prefix)/libexec/"' \
	  -DSAFE_PATH='"$(prefix)/libexec:/usr/local/bin:/usr/bin:/bin"'

suexec:	suexec.c suexec.h
	$(CC) $(CFLAGS) -o suexec suexec.c

install: $(addprefix $(INSTALL_LIBEXECDIR)/, $(BINS)) \
	$(addprefix $(INSTALL_SBINDIR)/, paperbag)
	@echo "Don't forget to do a post-install as root"

post-install:
	chown root $(INSTALL_LIBEXECDIR)/suexec
	chmod u+s $(INSTALL_LIBEXECDIR)/suexec

#
# Control node installation (okay, plastic)
#
control-install:	$(addprefix $(INSTALL_BINDIR)/, plasticwrap)

clean:
	rm -f *.o $(BINS) core
