#
# EMULAB-COPYRIGHT
# Copyright (c) 2000-2004 University of Utah and the Flux Group.
# All rights reserved.
#

SRCDIR		= @srcdir@
TESTBED_SRCDIR	= @top_srcdir@
OBJDIR		= ..
SUBDIR		= event

include $(OBJDIR)/Makeconf

SYSTEM	       := $(shell uname -s)

SUBDIRS		= lib tbgen trafgen program-agent proxy example linktest
ifeq ($(SYSTEM),FreeBSD)
SUBDIRS	       += sched delay-agent nsetrafgen stated
endif

all:	$(SUBDIRS)

include $(TESTBED_SRCDIR)/GNUmakerules

lib:
	@$(MAKE) -C lib all

sched:
	@$(MAKE) -C sched all

tbgen:
	@$(MAKE) -C tbgen all

example:
	@$(MAKE) -C example all

trafgen:
	$(SRCDIR)/trafgen/tg-install $(SRCDIR)/trafgen
	@$(MAKE) -C trafgen all

nsetrafgen:
	@$(MAKE) -C nsetrafgen all

delay-agent:
	@$(MAKE) -C delay-agent all

program-agent:
	@$(MAKE) -C program-agent all

stated:
	@$(MAKE) -C stated all

proxy:
	@$(MAKE) -C proxy all

proxy:
	@$(MAKE) -C linktest all

install: 
	@$(MAKE) -C lib install
	@$(MAKE) -C sched install
	@$(MAKE) -C tbgen install
	@$(MAKE) -C stated install

client-install:
ifeq ($(SYSTEM),FreeBSD)
	@$(MAKE) -C delay-agent client-install
endif
	@$(MAKE) -C tbgen client-install
	@$(MAKE) -C program-agent client-install
	@$(MAKE) -C trafgen client-install
	@$(MAKE) -C proxy client-install
	@$(MAKE) -C linktest client-install

control-install: 
	@$(MAKE) -C lib control-install
	@$(MAKE) -C tbgen control-install

clean:		subdir-clean

subdir-clean:
	@$(MAKE) -C lib clean
	@$(MAKE) -C sched clean
	@$(MAKE) -C tbgen clean
	@$(MAKE) -C example clean
	@$(MAKE) -C trafgen clean
	@$(MAKE) -C delay-agent clean
	@$(MAKE) -C program-agent clean

distclean:	subdir-distclean

subdir-distclean:
	@$(MAKE) -C lib distclean
	@$(MAKE) -C sched distclean
	@$(MAKE) -C tbgen distclean
	@$(MAKE) -C example distclean
	@$(MAKE) -C trafgen distclean
	@$(MAKE) -C delay-agent distclean
	@$(MAKE) -C program-agent distclean

.PHONY:	$(SUBDIRS)

