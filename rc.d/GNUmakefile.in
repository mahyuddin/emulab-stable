#
# EMULAB-COPYRIGHT
# Copyright (c) 2000-2006 University of Utah and the Flux Group.
# All rights reserved.
#
# For installation.
#
SRCDIR		= @srcdir@
TESTBED_SRCDIR	= @top_srcdir@
OBJDIR		= ..
SUBDIR		= rc.d

WINSUPPORT      = @WINSUPPORT@
PELABSUPPORT    = @PELABSUPPORT@
SYSTEM         := $(shell uname -s)

include $(OBJDIR)/Makeconf

RC_SCRIPTS	= 2.mysql-server.sh 3.testbed.sh 2.elvind.sh \
		  2.dhcpd.sh 1.mysql-client.sh
OPS_SCRIPTS     = 2.elvind.sh 3.and.sh 1.mysql-client.sh 1.mysql-server.sh

ifeq ($(SYSTEM),FreeBSD)
FBSDVERSION   := $(shell uname -v | sed -e 's/FreeBSD \([0-9]\).*/FreeBSD\1/')

ifeq ($(FBSDVERSION),FreeBSD6)
ifeq ($(WINSUPPORT),1)
OPS_SCRIPTS += silly.sh
endif
else
RC_SCRIPTS  += 1.named.sh
endif
endif
ifeq ($(WINSUPPORT),1)
OPS_SCRIPTS += pelab.sh
endif

#
# Force dependencies to make sure configure regenerates if the .in file
# is changed.
# 
all: $(RC_SCRIPTS) $(OPS_SCRIPTS)

include $(TESTBED_SRCDIR)/GNUmakerules

# Like the INSTALL_BINDIR target
$(INSTALL_RCDIR)/%: %
	@echo "Installing $<"
	-mkdir -p $(INSTALL_RCDIR)
	$(INSTALL_PROGRAM) $< $@


install: $(addprefix $(INSTALL_RCDIR)/, $(RC_SCRIPTS))

control-install:	$(addprefix $(INSTALL_RCDIR)/, $(OPS_SCRIPTS))
