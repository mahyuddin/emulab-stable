How to make a generic image from a Utah one:

1. Load up the current FBSD+RHL image.

2. FreeBSD:

2a. Update the Emulab software
   See for example, ~mike/obj/doclient.

2b. Turn off cvsup
	sudo rm -rf /root/.cvsup
	sudo cp /dev/null /etc/emulab/nosup

2c. Change the root password.
   Set it to something generic like the newnode MFS password via
	sudo passwd root
   Once you set it in master.passwd, you will have to hand copy
   the password hash to /etc/emulab/master.passwd.  Make sure you change
   both the root and toor password hashes (in the /etc/emulab file).

2d. Install a generic kernel.
   Build a kernel from the TESTBED-GENERIC config, and install it as
   /kernel.

2e. Shutdown to single user and run the prepare script.
   I always first umount NFS directories:
	umount -h fs
   Then run prepare:
	cd /usr/local/etc/emulab
	./prepare
   Then I remove /users and /proj mount points:
	rmdir /users/* /proj/*
   Note that this looks really dangerous, in the case where something is
   still NFS mounted, but it isn't since I use "rmdir" which will not
   remove a directory that isn't empty or a mount point.

2f. Remove the Utah SSL certs and SSH host keys
	rm /etc/ssh/ssh_host*
	rm /etc/emulab/*.pem

2g. Reboot into Linux

3. Linux:

3a. Update the Emulab software.

3b. Turn off cvsup
	sudo rm -rf /root/.cvsup
	sudo cp /dev/null /etc/emulab/nosup

3c. Change the root password.
   Set it to something generic like the newnode MFS password via
	sudo passwd root
   Once you set it in /etc/shadow, you will have to hand copy
   the password hash to /etc/emulab/shadow.  Make sure you change
   both the root and toor password hashes (in the /etc/emulab file).

3d. Install a generic kernel.
   We do not yet have such a thing for Linux.  So we hope the
   current kernel is "generic enough".

3e. Shutdown to single user and run the prepare script.
   I always first umount NFS directories:
	umount -at nfs
   Then run prepare:
	cd /usr/local/etc/emulab
	./prepare
   Then I remove /users and /proj mount points:
	rmdir /users/* /proj/*
   Note that this looks really dangerous, in the case where something is
   still NFS mounted, but it isn't since I use "rmdir" which will not
   remove a directory that isn't empty or a mount point.

3f. Remove the Utah SSL certs and SSH host keys
	rm /etc/ssh/ssh_host*
	rm /etc/emulab/*.pem

3g. Reboot into the admin MFS

4. Create the image.
