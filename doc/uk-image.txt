Stuff I did to make a node image for University of Kentucky and Georgia Tech.
Much of this overlaps with local image creation (see newimage.txt).

Start with one of our freshly loaded images.

A. FreeBSD (while running single user):

* Make sure local filesystems are mounted:
  mount -at ufs

* /root/.cvsup/auth
  Customize host/domain, change the password.  Then run "cvpasswd" giving the
  password just used.  Put the line spit out by cvpasswd in the boss node's
  /usr/testbed/sup/cvsupd.passwd file.

* /root/.ssh
  Remove known_hosts if it exists.  Put in local boss root pub key.
  Leave in our pub key if acceptible.

* /etc/hosts
  Fix the fully qualified name for localhost.

* /etc/localtime
  Copy the correct file over from /usr/share/zoneinfo

* /etc/motd
  Reflect new site

* /etc/rc.conf
  set ntpdate_flags to boss.uky.emulab.net

* /etc/ntp.conf
  Put in IP of time server

* /etc/testbed/master.passwd
  Change the root password, this file will get installed by prepare.

* /etc/ssh/ssh_host*
  Generate new host keys.  Actually, copy from an existing image.

* /etc/testbed/{client,emulab}.pem
  Generate a new one.  From Leigh:
      Just need to cd into the ssl directory and do a gmake
      (on their boss of course!) then a gmake boss-installX.
      The images need emulab.pem and client.pem from that directory.

* /etc/testbed/supfile
  Fix release tag (FBSD*) if necessary
  [ DON'T FORGET TO FIX UP cvsup TREE on boss ]

* /var/emulab/sup/sup/*/checkouts
  Remove these files.

* /usr/local/etc/testbed/tmcc
  Install a binary customized for the site.  Created as part of the
  general testbed software build.  You may not need to do this, run:
  "tmcc bossinfo" and see what it says.

* /usr/site
  Remove it.

* Run /usr/local/etc/testbed/prepare
  This will install clean passwd and group files, clean out log files
  and take care of various other lint.

* Unmount filesystems, and remount root read-only to be safe:
  cd /
  umount -h <fs node name>
  umount -at ufs
  mount -u -o ro /


B. While running Linux (single user):

* /root/.cvsup/auth
  Customize host/domain, leave password alone?

* /root/.ssh
  Remove known_hosts if it exists.  Put in local boss root pub key.
  Leave in our pub key if acceptible.

* /etc/hosts
  Fix the fully qualified name for localhost.

* /etc/localtime
  Copy the correct file over from /usr/share/zoneinfo

* /etc/ntp/step-tickers /etc/ntp.conf
  Put in IP of time server.

* /etc/ssh/ssh_host*
  Generate new host keys.  Actually, copy from an existing image.

* /etc/testbed/shadow
  Change the root password, this file will get installed by prepare.

* /etc/testbed/{client,emulab}.pem
  Generate a new one.  From Leigh:
      Just need to cd into the ssl directory and do a gmake
      (on their boss of course!) then a gmake boss-installX.
      The images need emulab.pem and client.pem from that directory.

* /etc/testbed/supfile
  Fix release tag (RHL*) if necessary.

* /var/emulab/sup/sup/*/checkouts
  Remove these files.

* /etc/testbed/tmcc
  Install a binary customized for the site.  Must be built from testbed
  source under Linux (duh!)  Again, you may not need this, run:
  "tmcc bossinfo" to verify.

* /usr/site
  Remove it.

* Run /usr/local/etc/testbed/prepare
  This will install clean passwd and group files, clean out log files
  and take care of various other lint.

* Remount root filesystem read-only (IMPORTANT!)
  cd /
  mount -o remount,ro /

* Fsck it for good luck.  Actually, not only good luck but also resets
  some time stamp that forces an fsck periodically
  fsck -f <root device>

D. Frisbee MFS (boss:/tftpboot/frisbee/boot/mfsroot):

E. FreeBSD MFS (boss:/tftpboot/boot/mfsroot):
