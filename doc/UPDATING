Information necessary for keeping boss and ops node up-to-date. This
file contains updates that must be made outside of the database and
the intall tree (ie. /usr/testbed).

This file is in the same format at the FreeBSD UPDATING file, whis is
to say, in reverse chronological order, with the date of the change
in YYYYMMDD format.

20040901:
	New SSL version of the XMLRPC server.

	* Install this port on both boss and ops:

		/usr/ports/security/py-m2crypto	

	* Reconfig, rebuild, and reinstall the testbed software on your
	  boss node. Be sure to pick up changes in sql/database-migrate.

	* Install some ssl files on boss:

		cd /usr/object/tree/ssl
		gmake usercert-install

        * Install new version of testbed startup script on boss
	  
		cd /usr/object/tree/rc.d
		sudo gmake install

        * Generate SSL certificates for existing emulab users

		cd /usr/src/tree/sql
		./initcerts.pl

	* Add the following lines to /etc/syslog.conf on boss

	  !sslxmlrpc
	  *.*                            /usr/testbed/log/sslxmlrpc.log

	* Add the following line to /etc/newsyslog.conf on boss

	  /usr/testbed/log/sslxmlrpc.log          640  7     1000 *     Z

        * Create the log file and restart syslog on boss
	
		sudo touch /usr/testbed/log/sslxmlrpc.log
		sudo kill -HUP `cat /var/run/syslog.pid`

        * Fire up the SSL XMLRPC server

		sudo /usr/testbed/sbin/sslxmlrpc_server.py


20040816:
	The event system has moved to users.emulab.net.

	* Install the elvin libraries and daemon on users.emulab.net.

	* Pick up this package:

	     http://boss.emulab.net/downloads/ulsshxmlrpcpp-0.1.0.tar.gz

             cd /someplace
	     tar zxf ulsshxmlrpcpp-0.1.0.tar.gz
	     cd ulsshxmlrpcpp-0.1.0
	     configure
	     gmake
	     sudo gmake install

	* Reconfig, rebuild, and reinstall the testbed software on your
	  boss node.

	* Reconfig, rebuild, and reinstall the testbed software on your
          users node. 

		ssh users
		cd /your/object/tree/obj/
		gmake
		gmake control-install
		cd /your/object/tree/obj/event/etc
		sudo gmake control-install

        * Install the new elvind config file on boss and restart elvind
          Note that this is not done as part of toplevel install.

		cd /your/object/tree/obj/event/etc
		sudo gmake install
		sudo /usr/local/etc/rc.d/2.elvind.sh stop
		sudo /usr/local/etc/rc.d/2.elvind.sh start

	* Restart tmcd and stated on boss (note that if you plan to just
	  reboot boss, a lot of these steps can be skipped).

		sudo /usr/testbed/sbin/tmcd.restart
		sudo kill -USR1 `cat /var/run/stated.pid`

        * Install the elvind config file on users.
          Note that this is not done as part of toplevel install.

		ssh users
		cd /your/object/tree/obj/event/etc
		sudo gmake control-install

	* Install new rc.d file on boss.
          Note that this is not done as part of toplevel install.

		cd /your/object/tree/obj/rc.d
		sudo gmake install

        * Install the rc.d file that starts elvind on users.
          Note that this is not done as part of toplevel install.

		ssh users
		cd /your/object/tree/obj/rc.d
		sudo gmake control-install

        * Start the elvin server on users.emulab.net:

		ssh users
		sudo /usr/local/etc/rc.d/2.elvind.sh

	* Create the ops certificate (on boss) and copy it to your users node.

		cd /your/object/tree/obj/ssl
		gmake ctrlnode.pem
		sudo scp ctrlnode.pem users:/etc/emulab/client.pem
		sudo ssh users chmod 600 /etc/emulab/client.pem
		sudo scp emulab.pem users:/etc/emulab

        * Install the tmcd client stuff on users.emulab.net.

		ssh users.emulab.net
		cd /your/object/tree/obj/tmcd/freebsd
		sudo gmake control-install

        * Create the emulab-ops/opsnode experiment. Do this the same way
          that hwdown is created in setup-db.txt.

	* Create a node_types entry for ops. This is mostly just a stub
	  entry so that tmcd will recognize it and so that other parts of
	  the system are happy. Be sure that you get the interface correct,
	  and set the Default OSID to emulab-ops/OPSNODE-BSD. The type is
	  ops and the class is misc.

	* Create the ops node nodes table entry ...

	* Place the ops node into the above experiment:

		wap nalloc emulab-ops opsnode ops

	* Make sure that netcat is installed.

		cd /usr/ports/net/netcat
		sudo make
		sudo make install
		
	* Add entry to /etc/services for elvin:

		elvin		2917/tcp

	* Change the CNAME event-server to your zone file from boss to ops.

		event-server	IN	CNAME	ops

	* Start the alternate inetd service so that old images trying to
	  connect to the event server are redirected to users.emulab.net.
	  Be sure to replace boss.foo.bar with the right name.

		sudo inetd -a boss.foo.bar -p /var/run/testbed-inetd.pid \
			/usr/testbed/etc/inetd.conf

20040815:
	After some changes to ptopgen, you'll need to run the following SQL
	command to keep vnodes working properly:

	update os_info set nextosid='FBSD-STD' \
	    where osid='emulab-ops-FBSD-JAIL';

20040809:
	New syslog file for logging requests to the XMLRPC server.

		sudo touch /usr/testbed/log/xmlrpcbag.log

	Add these two lines to /etc/syslog.conf and then HUP syslogd:

		!xmlrpcbag
		*.*                      /usr/testbed/log/xmlrpcbag.log

        Add this line to /etc/newsyslog.conf:

		/usr/testbed/log/xmlrpcbag.log      640  7     1000 *     Z

20040805:
	Add a new CNAME for boss to /etc/namedb/<OURDMAIN>.db.head -
	event-server . Re-run named_setup on boss to make this change
	take place. In the future, we may move this CNAME to ops.

20040713:
	For new distributed routing support, must first run this script as
        root to generate a data file for each existing experiment.

		sudo sql/gentopmaps.pl

20040625:
	After updating to revision 1.257 of sql/database-migrate.txt,
        run sql/devlnodes.pl to clear out all of the non reserved
        pcvm nodes. Be sure to do a current install of the software, and
        then:

		update node_types set isdynamic=1 where type='pcvm';

20040615:
	If you update the ports on your boss node, you'll need to take
	into accout that FreeBSD is in the process of changing how its
	rc.d scripts work - add the following two lines to the bottom
	of your /etc/rc.conf on boss:
	  dhcpd_enable="YES"
	  apache_enable="YES"

20040601:
	The p5-Time-HiRes port is now required on both boss and ops -
	install it from /usr/ports/devel/p5-Time-HiRes .

20040420:
	Switched web search button backend from webglimpse to swish-e.
        Just need to go to /usr/ports/www/swish-e and install the port.

20040303:
	Fixed the way we handle the certificate for capture with tiptunnel.
	We no longer hard-code the certificate digest in nodetipacl.php3 .
	However, as a result, we must place this fingerprint in a publically-
	readable file on boss. So, if you have serial lines that you're
	running with capture:
	1) Copy your /usr/testbed/etc/capture.pem file from your tipserver to
	boss, if it isn't there already.
	2) In /usr/testbed/etc/ on boss, run: 'openssl x509 -sha -noout
	-fingerprint -in capture.pem > capture.fingerprint', and make this
	file world-readable.

20040302:
	Changed the length of the node_id columns from 10 to 32. Make sure
	you re-compile and restart all daemons written in C (such as
	tmcd, tevd, and the event schedulers) before putting any nodes in
	the database with names longer than 10 characters.

20040226:
	Re-worked the way named_setup handles virtual nodes and unroutable
	IP addresses - no point in handling the two differently. Thus, the
	'vnodes.<OURDOMAIN>.db' DNS zone file is no longer generated.
	Instead, if you have a mix of routable and unroutable IP addresses,
	you'll need to switch to using the '<OURDOMAIN>.internal.db' zone
	file - see Step 6 of doc/setup.txt for instructions on setting up
	this file.

20040121:
	Changed the 3.testbed.sh rc.d script to handle 'start' and 'stop'
	arguments properly. Install a fresh copy of rc.d/3.testbed.sh into
	/usr/local/etc/rc.d .

20040120:
	Bumped up the sizes on some buffers to help network performance.
	Add the following two lines to /etc/sysctl.conf:

	net.local.dgram.maxdgram=65536
	net.local.dgram.recvspace=65536


20040112:
       Big change to bootinfo sequence.

       * Update DB with new contents of sql/database-fill.sql *and
         sql/database-fill-suplement.sql.
       * Rebuild pxeboot kernel from source (src/sys/boot/i386/emuboot).
         Install emuboot to /tftpboot/pxeboot.emu
       * Install new version of dhcpd.conf file that has all the PXE
         crap removed and includes the single line:

		filename "/tftpboot/pxeboot.emu";

       * Restart dhcpd. 
       * Kill proxydhcp. Be sure to install new 3.testbed.sh from the
         rc.d directory to /usr/local/etc/rc.d, or just edit in place
       * Restart bootinfo.
       * Restart stated.
       * Reboot all non allocated nodes so that they go into pxewait mode.

20031215:
	The mod_php4 port on boss should be recompiled with the
	'xmlrpc' option, in addition to the 'mhash' option already
	used. Apache on boss will need to be restarted after the new
	port is installed.

