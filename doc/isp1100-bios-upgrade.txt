How to upgrade the BIOS on an ISP1100:

[ Notes make 10/01 when upgrading to TR440BXA.86B.0042.P15.0107200951
  (aka "revision 15", needed for new PXE code). ]

The 10,000 foot view is that you boot a machine on a DOS floppy and run a
script and then reboot.  The step-by-step details:

0. Reserve the node.  There is a bios-update experiment for this purpose.
   In fact, Rob has it setup so that all the nodes that haven't been
   upgraded get put in this experiment when they are freed.  So you can
   likely skip this step, but just in case, you do (on boss):
	nalloc emulab-ops bios-update pcXXX

1. Kill the capture process for the node.  You will need to talk to the
   node at 19200 baud after flashing the BIOS.  So login to ops (pc41-120)
   or tipserv1 (pc121-128) and kill the capture process.

2. Stick in the floppy and boot from it.  I have a whole pile (8) of ISP1100
   BIOS update floppies.  Grab one and stick it into the machine in question.
   Tip to the direct console line ("pcXXX-tty") and reboot the node.

      NOTE: because of a screw up on my part, the ISPs will boot
      from the network before the floppy.  There are two ways to
      fix this, you can take the node out of the DHCP configuration
      temporarily so it will fall back on a floppy boot, or you can
      go into the BIOS and reset the boot order to have floppy first.
      I do the latter, which is described here.

   When you get the "type F2 to enter SETUP" message, type F2 and go
   into setup.  Go to the boot menu and set the first choice to floppy
   (don't bother to do anything fancier, we are about to wipe out this
   BIOS setting anyway).  Save the change and let it boot from the floppy.

3. Flash the BIOS.  Type "1" followed by newline at the DOS command prompt.
   I then wait for it to put out the message about programming the BIOS
   to make sure it is going.  At that point I get out of tip, and get back
   in with:
	tip -19200 pcXXX-tty
   You need to do this since, when the BIOS flash is done, it will reboot
   and the serial console will be back to the default baud rate of 19200.

4. Restore the BIOS settings (note that floppy is now before PXE in
   the boot order!):

	1. Main menu
		processor serial number -> disabled
	2. Security menu
		set supervisor password (NOT user password)
		user level access -> view only
	3. Boot menu
		after power fail -> power on
		1st boot -> floppy
		2nd boot -> <first PXE choice>
		3rd boot -> IDE-HD
		the rest -> disable
	4. System management menu
		serial baud -> 115200
		flow control -> none
	5. Exit
		exit saving changes -> yes

   After hitting newline and saving the BIOS changes, get out of tip
   and get back in again at 115200 baud:
	tip pcXXX-tty
   and prepare for the next step.

5. Shut up the PXE code.  As the machine reboots again, you will need
   to turn off 3 different PXE prompts (why 3 and not 4?  No idea...)
   So wait til you see the "type ^S blah blah blah", and type ^S.
   Set the prompt to "disable" and set the wait time to "0 seconds"
   and then type F4 to save and exit.  Wait for the next prompt and
   repeat.  Wait for the final prompt and repeat.

6. Clean up.  When you have neutered all the prompts, the machine will
   reboot on the floppy again.  Go down, pop out the floppy and hit the
   reset button.  Get out of tip and restart the capture (see
   /usr/site/etc/capture.rc for the appropriate command line).
   If you forgot to reboot the machine while you were downstairs,
   (I always do) power cycle the node now.

	NOTE: CTRL-ALT-DEL won't work on the serial line!
	At best nothing will happen, at worst you will reboot
	the machine you are sitting at!

   You can then get back into tip:
	tip pcXXX
   and make sure everything comes back up ok.

7. Update the DB.  Free the node from the bios-update experiment:
	nfree emulab-ops bios-update pcXXX
   and mark that the BIOS has been upgraded:
	mysql tbdb
	update nodes set bios_version="TR440BXA.86B.0042.P15.0107200951" where node_id='pcXXX';

Done!
