#!/usr/bin/perl
use lib 'lib';
use SemiModern::Perl;
use Data::Dumper;

{
  use Getopt::Long;
  my $pjobs   = 1;
  my $logging = 0;
  my $timing;
  my $verbose;
  my $result = GetOptions (
      "jobs=i"     => \$pjobs,
      "logging=i"  => \$logging,
      "timing"     => \$timing,
      "verbose"    => \$verbose);

  if ($pjobs > 1) {
    $ENV{'HARNESS_OPTIONS'} = "j$pjobs";
  }
  if ($timing) {
    $ENV{'HARNESS_TIMER'} = 1;
  }
  if ($verbose) {
    $ENV{'HARNESS_VERBOSE'} = 1;
    $ENV{HARNESS_COLOR} = 1;
  }
}
my $THARNESS = 'perl t/harness';

sub usage {
  our $ts;
  sub wanted {
    if (-f && /\.t$/) {
      $ts .= "        " . $File::Find::name . "\n";
    }
  }
  use File::Find;
  find(\&wanted, 't');

  print <<"USAGE";
./tbts 
        test
USAGE
  print $ts;
}

if (@ARGV) {
  my $cmd = $ARGV[0];
  $_   = $cmd;
  if (/critic/) { exec 'perlcritic .'; }
  elsif (/lib/)   { exec "$THARNESS t/lib/*.t t/lib/*/*.t"; }
  elsif (/test/)   { exec $THARNESS; }
  elsif (/test/)   { exec "$THARNESS t/topologies/*.t"; }
  elsif (/.*\.t$/) { exec "$THARNESS $cmd"; }
}
else {
  print usage();
}

