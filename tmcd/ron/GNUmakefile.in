#
# EMULAB-COPYRIGHT
# Copyright (c) 2000-2002 University of Utah and the Flux Group.
# All rights reserved.
#

#
# XXX ONLY RUN THIS INSTALL ON A FREEBSD RON NODE!
#
# Trivial. These things just need to be installed into the right place
# on a testbed node before cutting an image.
#
#
SRCDIR		= @srcdir@
TESTBED_SRCDIR	= @top_srcdir@
OBJDIR		= ../..
SUBDIR		= tmcd/ron

include $(OBJDIR)/Makeconf

all:	bossnode

include $(TESTBED_SRCDIR)/GNUmakerules

DESTDIR		=
INSTALL_DIR	= $(DESTDIR)/usr/local/etc/emulab
INSTALL		= /usr/bin/install -c 
INSTALL_PROG	= /usr/bin/install -c -m 755

install:	misc-install script-install bin-install

dir-install:
	-mkdir -p $(INSTALL_DIR)
	cp /dev/null $(INSTALL_DIR)/isrem

misc-install:	dir-install bossnode
	$(INSTALL) bossnode $(INSTALL_DIR)/bossnode

bin-install:	dir-install
	$(INSTALL_PROG) ../tmcc $(INSTALL_DIR)/tmcc

script-install:	dir-install
	$(INSTALL_PROG) $(SRCDIR)/update $(INSTALL_DIR)/update
	$(INSTALL_PROG) $(SRCDIR)/vnodesetup $(INSTALL_DIR)/vnodesetup
	$(INSTALL_PROG) $(SRCDIR)/watchdog $(INSTALL_DIR)/watchdog
	$(INSTALL_PROG) $(SRCDIR)/../libsetup.pm $(INSTALL_DIR)/libsetup.pm
	$(INSTALL_PROG) $(SRCDIR)/liblocsetup-freebsd.pm \
			$(INSTALL_DIR)/liblocsetup-freebsd.pm
	$(INSTALL_PROG) $(SRCDIR)/liblocsetup-linux.pm \
			$(INSTALL_DIR)/liblocsetup-linux.pm
	$(INSTALL_PROG) $(SRCDIR)/rc.testbed $(INSTALL_DIR)/rc.testbed
	$(INSTALL_PROG) $(SRCDIR)/emulabctl $(INSTALL_DIR)/emulabctl
	$(INSTALL_PROG) $(SRCDIR)/install.sh $(INSTALL_DIR)/install.sh
	$(INSTALL_PROG) $(SRCDIR)/reinstall $(INSTALL_DIR)/reinstall.sh

post-install:
	chown root $(INSTALL_DIR)/update
	chmod u+s $(INSTALL_DIR)/update
	chown root $(INSTALL_DIR)/vnodesetup
	chmod u+s $(INSTALL_DIR)/vnodesetup

#
# We build the bossnode file from config info
#
bossnode:	GNUmakefile
	echo >$@ "$(BOSSNODE)"

clean:
	rm -f bossnode
