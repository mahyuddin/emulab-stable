#!/bin/sh
#
# EMULAB-COPYRIGHT
# Copyright (c) 2000-2004 University of Utah and the Flux Group.
# All rights reserved.
#
. /etc/emulab/paths.sh

if [ x$reason != xREBOOT -a x$reason != xBOUND -a x$reason != xRENEW -a x$reason != xREBIND ]
then
    exit 0
fi

#
# ElabinElab support
#
if [ "$new_host_name" = "" ]; then
    #
    # If no hostname provided, it means that its an outer emulab
    # returning DHCPD info, in which case all we want to do is configure the
    # interface, but not allow dhclient to think it has finished its job.
    # So, exit with non-zero status and dhclient will keep trying to configure
    # another interface (the inner control network).
    #
    exit 1
fi

#
# Remember our server IP, real hostname, router IP, etc.
#
echo $new_dhcp_server_identifier > $BOOTDIR/bossip
echo $new_host_name > $BOOTDIR/realname
echo $new_routers > $BOOTDIR/routerip
echo $new_ip_address > $BOOTDIR/myip
echo $new_subnet_mask > $BOOTDIR/mynetmask
if [ -n "$interface" ]; then
    echo $interface > $BOOTDIR/controlif
fi

#
# See if the Testbed configuration software wants to change the hostname.
# 
$BINDIR/sethostname.dhclient >$LOGDIR/dhclient.log 2>&1

#
# The killing of dhclient and shutdown of other interfaces is handled
# by the dhclient caller (sysconfig/network-scripts/ifcfg-eth99)
#

exit 0
