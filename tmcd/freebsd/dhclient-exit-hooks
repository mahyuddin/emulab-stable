#!/bin/sh
#
# EMULAB-COPYRIGHT
# Copyright (c) 2000-2004 University of Utah and the Flux Group.
# All rights reserved.
#
. /etc/emulab/paths.sh

#
# Remember our server IP, real hostname, router IP, etc.
#
if [ x$reason = xREBOOT ] || [ x$reason = xBOUND ] || [ x$reason = xRENEW ]
then
	echo $new_dhcp_server_identifier > $BOOTDIR/bossip
	echo $new_host_name > $BOOTDIR/realname
	echo $new_routers > $BOOTDIR/routerip
	echo $new_ip_address > $BOOTDIR/myip
	echo $new_subnet_mask > $BOOTDIR/mynetmask
fi

#
# See if the Testbed configuration software wants to change the hostname.
# Installed into /etc.  Note: frisbee MFS doesn't have perl and hence
# doesn't have this script.
# 
if [ -x $BINDIR/sethostname ]
then
    $BINDIR/sethostname $new_domain_name >$LOGDIR/dhclient.log 2>&1
fi

#
# Once we have an IP address, we can stop dhclient so that it doesn't get
# in the way 
#
if [ x$reason = xREBOOT ] || [ x$reason = xBOUND ] || [ x$reason = xRENEW ]
then
	# I'd love to use the dhclient.pid file, but it helpfully has not been
	# created at this point
	killall dhclient
fi  

exit 0
